{{$ssh_factory_conf := "/factory/devel/ssh"}}
{{$ssh_common_conf := "/common/devel/ssh"}}
{{$ssh_local_conf := "/local/devel/ssh"}}
{{$source := include "/lib/systemd/system/dropbear.socket"}}

{{if (ne $source "")}}
     #
     # generated by confd
     # do not edit
     #
     {{if or (exists $ssh_factory_conf) (exists $ssh_common_conf) (exists $ssh_local_conf)}}
         {{$factory_defs := getv $ssh_factory_conf ""}}
         {{$common_defs := getv $ssh_common_conf ""}}
         {{$local_defs := getv $ssh_local_conf ""}}
         {{$ssh := merge $factory_defs $common_defs $local_defs}}
	 {{$port := integerValue $ssh.port 22}}
     	 {{regReplace $source "ListenStream=([0-9]+)" (printf "ListenStream=%v" $port)}}
    {{else}}
	 {{$source}}
    {{end}}
{{end}}
